---
title: 去 Docker 化
date: 2020-04-03 22:24:08
tags: Docker
categories: 工作思考
---
容器化是最近几年大火的工程理念，而这个理念的背后则是 Docker 的身影。因为没有技术包袱的原因，以及当时对 GPU 资源划分的需求，我所在的小组选择了 Docker 和 Kubernetes 作为了智能算法开发和智能平台研发的底层技术支撑。在将近三年有限的容器化过程中，我遇到许许多多看似微小却总是让我心生厌烦的实际问题，我竟渐渐萌生了去 Docker 化的想法，实在是让人大吃一惊。同事们听了我的想法，也纷纷发出我在开历史倒车的感叹。

最近因为一个算法框架的运行环境的安装，我站在了选择容器和裸机的分岔路上，我开始犹豫不决，不在义无反顾地选择容器，选择 Docker。我开始谨慎地考虑 Docker 的使用，开始担心利用 Docker 快速地入门和上手会给后续的安装部署使用埋下无数的工作量。就像没有使用类型标注编写的 Python 代码，将会为后期代码的开发和维护带来巨大的隐形成本一样，Docker 在工作中的使用，也会为后续的工作埋下巨大的成本炸弹。

因此，我想详细描述一下 Docker 给我带来的不便，希望能给大家带来一些思考。

## 伪跨平台

Docker 的宣传语是“一次构建，随处运行”，实在是和 Java 的“一次编译，随处运行” 差远了！你以为你可以将编写的程序打成一个 Docker 镜像，然后便可以在任意的操作系统以及任意的芯片指令集上运行这个镜像，那你恐怕就要上当受骗了！事实上，Docker 目前只能原生支持 Windows 10 专业版及以上版本，其它 Windows 版本需要在 Windows 上安装一个 Linux 虚拟机才能使用 Docker。此外，你在 x86-64 机子上制作的镜像，是无法直接运行在 arm64 架构的机子上的。所以，Docker 的跨平台是个伪命题。

## Docker 自身难

想要运行 Docker 镜像，需要先安装 Docker 自身。然而，Docker 自身的安装已经是个不小的工作量了。各大常见的操作系统内置的 Docker 版本大多停留在 1.13 这个版本，而 Docker 官方则在自己维护的源里面发布新的版本，并改名了叫 docker-ce。在一些更老的 Linux 发布版本上，Docker 的版本甚至是 1.8 这个版本左右，容易产生许多的兼容问题。特别是在无网的工作环境中，Docker 的安装还会遇到很多依赖的问题。

除了 Docker 本身安装的困难，Docker 的运维也会产生巨大的工作量。默认的镜像和容器信息保存在 `/var/lib/docker` 目录下，常常会因为根目录空间的不够而导致无法运行新的镜像。Centos 上默认的 Docker volume 常常不适合在生产环境使用，需要额外的配置。

## 无保障

在使用 Docker 后，如果没有配套的专业团队，Docker 的运维工作也就落在了使用者的手里。没有配套的生态环境，没有基础镜像，没有镜像仓库，没有经验。在全公司都还没有进行容器化迁移的时候，贸然决定使用 Docker 更是难上加难。使用 Docker 是需要一定的学习成本的，熟练使用 Docker 更是拥有巨大学习成本。Dockerfile 的编写、DockerCompose 的编写、Docker 本身概念的理解、Docker 日志的查看这些都需要学习成本。同时使用容器后，你便会想要对容器进行编排。K8S 又会是一个不得不做的选择，而 K8S 的学习成本更是不容小觑。此外，在没有一个强有力的领导来推动容器化这个事情的时候，工程师们学习新技术的愿望并不强烈，明明不用 Docker 就能解决的事情，为什么需要使用 Docker。在没有深入使用过 Docker 的人看来，Docker 并不是必需的选择。宁愿用许多重复的步骤来代替需要精力的学习。我也时常需要警惕这样的想法。因为不愿意写单元测试，而常常选择手动测试。

## 聊聊未来

去 Docker 化是我一种思考，虽然不一定对，但我自己觉得是有价值的。同事问我“不用 Docker用什么”的时候，我嘴上说“不知道”，但我心理是有想法的，因为我觉得 Docker 没有出现的时候，许多问题依然可以得到解决。然而，就像“嘴上说着不要，心理倒是很诚实”，我依然还在使用 Docker，也觉得容器化是仍然是大势所趋。而且 Docker 也开始有出现一些好的变化：Docker Hub 上面已经有不同架构的基础镜像；越来越多的公司开始有专门的容器化平台团队；说不定还有轻量版的K8S。未来总是光明的，永远相信美好的事情即将发生。^_^